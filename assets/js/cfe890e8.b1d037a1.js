"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4682],{2558:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var s=t(5893),o=t(1151);const a={sidebar_position:10},l="Developer Documentation",r={id:"developer-documentation/index",title:"Developer Documentation",description:"To get started with development first clone the repository.",source:"@site/docs/developer-documentation/index.mdx",sourceDirName:"developer-documentation",slug:"/developer-documentation/",permalink:"/docs/developer-documentation/",draft:!1,unlisted:!1,editUrl:"https://github.com/stustapay/stustapay/tree/master/website/docs/developer-documentation/index.mdx",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"docsSidebar",previous:{title:"TSE server setup",permalink:"/docs/administrator-documentation/tse/tseserversetup"},next:{title:"Simulator",permalink:"/docs/developer-documentation/simulator"}},i={},d=[{value:"Developing on your local machine",id:"developing-on-your-local-machine",level:2},{value:"Setup Backend for Development",id:"setup-backend-for-development",level:3},{value:"Setup the database",id:"setup-the-database",level:4},{value:"Setup web frontend for development",id:"setup-web-frontend-for-development",level:3},{value:"Running",id:"running",level:3},{value:"Formatting, Linting and Testing",id:"formatting-linting-and-testing",level:3},{value:"Developing in a devcontainer",id:"developing-in-a-devcontainer",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"developer-documentation",children:"Developer Documentation"}),"\n",(0,s.jsx)(n.p,{children:"To get started with development first clone the repository."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"git clone https://github.com/stustapay/stustapay.git\n"})}),"\n",(0,s.jsx)(n.h2,{id:"developing-on-your-local-machine",children:"Developing on your local machine"}),"\n",(0,s.jsx)(n.p,{children:"Install system requirements:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"python >= 3.11"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"nodejs >= 18"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"docker"})," (optional, recommended for running postgresql in a docker container)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"setup-backend-for-development",children:"Setup Backend for Development"}),"\n",(0,s.jsx)(n.p,{children:"Create a python virtualenv"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"python3 -m virtualenv -p python3 .venv\nsource .venv/bin/activate\n"})}),"\n",(0,s.jsx)(n.p,{children:"Install backend python module as a local editable python module.\nThis will install all python requirements needed for development and testing as well."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"pip install -e '.[dev,test]'\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You should now have the ",(0,s.jsx)(n.code,{children:"stustapay"})," command available."]}),"\n",(0,s.jsx)(n.h4,{id:"setup-the-database",children:"Setup the database"}),"\n",(0,s.jsx)(n.p,{children:"Start a local postgres instance via docker compose."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"docker compose -f docker/docker-compose.devel.yaml up\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will start a postgresql instance and bind it to the local port ",(0,s.jsx)(n.code,{children:"5433"}),"\n(to not conflict with already locally running postgres databases on the default port.)"]}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:"Use an already running local postgresql instance"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(n.p,{children:"Another option is to run a local postgresql instance."}),(0,s.jsxs)(n.p,{children:["In that case you have to take care of setting up a database user and database yourself.\nYou'll probably want to copy ",(0,s.jsx)(n.code,{children:"etc/config.devel.yaml"})," and adapt the database connection settings."]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Apply the database schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"stustapay -c etc/config.devel.yaml db migrate\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now you're mostly set up and ready to start developing and using the backend."}),"\n",(0,s.jsxs)(n.p,{children:["Head over to the ",(0,s.jsx)(n.a,{href:"/docs/developer-documentation/simulator",children:"simulator docs"})," to see how to generate test data and obtain a somewhat realistic test setup."]}),"\n",(0,s.jsx)(n.h3,{id:"setup-web-frontend-for-development",children:"Setup web frontend for development"}),"\n",(0,s.jsx)(n.p,{children:"To install the web ui requirements run"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"cd web\nnpm install\n"})}),"\n",(0,s.jsx)(n.h3,{id:"running",children:"Running"}),"\n",(0,s.jsx)(n.p,{children:"To start the administration web and customer web interfaces in development mode (supports live code reloading) run"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"npx nx serve administration\nnpx nx serve customerportal\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Other usefull commands for development (where ",(0,s.jsx)(n.code,{children:"project"})," is either ",(0,s.jsx)(n.code,{children:"customerportal"})," or ",(0,s.jsx)(n.code,{children:"administration"}),") are"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"npx nx build <project>\nnpx nx lint <project>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"formatting-linting-and-testing",children:"Formatting, Linting and Testing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# check format\nmake check-format\n# format code\nmake format\n# run linters\nmake lint\n# run tests (nondocker based postgres instance only)\nmake tests\n"})}),"\n",(0,s.jsx)(n.p,{children:"When using a docker based postgres instance as mentioned above, start the docker compose setup and run the tests using the following commands:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"docker compose -f docker/docker-compose.devel.yaml up\nTEST_DB_USER=stustapay_test TEST_DB_PASSWORD=stustapay_test TEST_DB_HOST=localhost TEST_DB_DATABASE=stustapay_test TEST_DB_PORT=5434 make test\n"})}),"\n",(0,s.jsx)(n.h2,{id:"developing-in-a-devcontainer",children:"Developing in a devcontainer"}),"\n",(0,s.jsxs)(n.p,{children:["You can use vscode's ",(0,s.jsx)(n.a,{href:"https://containers.dev/",children:"development containers"}),",\nwe've included a configuration file in the repo root."]}),"\n",(0,s.jsx)(n.p,{children:"After starting the devcontainer you can simply start up the core services and the web uis."}),"\n",(0,s.jsxs)(n.p,{children:["When using DevContainer make sure to forward the port globally. Otherwise the till will not be able to connect.\nIn the VSCode Settings set Remote: Local Port Host to ",(0,s.jsx)(n.code,{children:"allInterfaces"}),"\n",(0,s.jsx)(n.img,{src:"https://i.stack.imgur.com/oM0zl.png",alt:"https://stackoverflow.com/a/67997839"})]}),"\n",(0,s.jsx)(n.p,{children:"Troubles with the database?\nConnect to the database in the devcontainer pstgres-data (below dev volumes), then drop and re-create the schema."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"su - postgres -c psql"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"drop schema public cascade;"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"create schema public;"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>l});var s=t(7294);const o={},a=s.createContext(o);function l(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);