<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-user-guide/nfctags" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">NFC Tag Production | StuStaPay</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://stustapay.de/docs/user-guide/nfctags"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="NFC Tag Production | StuStaPay"><meta data-rh="true" name="description" content="StuStaPay supports the following NFC tags:"><meta data-rh="true" property="og:description" content="StuStaPay supports the following NFC tags:"><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://stustapay.de/docs/user-guide/nfctags"><link data-rh="true" rel="alternate" href="https://stustapay.de/docs/user-guide/nfctags" hreflang="en"><link data-rh="true" rel="alternate" href="https://stustapay.de/docs/user-guide/nfctags" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="StuStaPay RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="StuStaPay Atom Feed"><link rel="stylesheet" href="/assets/css/styles.2d32c33d.css">
<script src="/assets/js/runtime~main.20d73802.js" defer="defer"></script>
<script src="/assets/js/main.029610ef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="StuStaPay Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="StuStaPay Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">StuStaPay</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/stustapay/stustapay" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">StuStaPay</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/user-guide">User Guide</a><button aria-label="Collapse sidebar category &#x27;User Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/user-guide/nfctags">NFC Tag Production</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/administrator-documentation/installation">Administrator Documentation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/developer-documentation">Developer Documentation</a><button aria-label="Expand sidebar category &#x27;Developer Documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/user-guide"><span itemprop="name">User Guide</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">NFC Tag Production</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>NFC Tag Production</h1>
<p>StuStaPay supports the following NFC tags:</p>
<ul>
<li>MIFARE Ultralight AES (<code>MF0AES(H)20</code>)</li>
</ul>
<p>You can either program them using the StuStaPay Android App, or if you need larger quantities, find a supplier who can do the programming and id-lasering for you.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="secret-keys">Secret Keys<a href="#secret-keys" class="hash-link" aria-label="Direct link to Secret Keys" title="Direct link to Secret Keys">​</a></h2>
<p>There are two secret keys (the same for all chips).</p>
<p>To generate those keys:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">python3 -m stustapay -c &lt;your-config&gt;.yaml token generate-key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This yields you the generated keys as output:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Secret keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">key0 = &lt;16 bytes from </span><span class="token code-snippet code keyword" style="font-style:italic">`openssl rand -hex 16`</span><span class="token plain">&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">key1 = &lt;16 different bytes for key1&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">So:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> key0</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token url-reference url variable" style="color:rgb(191, 199, 213)">0</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token url-reference url" style="color:rgb(221, 221, 221)"> </span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token url-reference url" style="color:rgb(221, 221, 221)">for</span><span class="token plain"> clarification, the first first byte of key0&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> key0</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token url-reference url variable" style="color:rgb(191, 199, 213)">15</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token url-reference url" style="color:rgb(221, 221, 221)"> </span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token url-reference url" style="color:rgb(221, 221, 221)">key0</span><span class="token plain"> last byte&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> key1</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token url-reference url variable" style="color:rgb(191, 199, 213)">0</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token url-reference url" style="color:rgb(221, 221, 221)"> </span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token url-reference url" style="color:rgb(221, 221, 221)">key1</span><span class="token plain"> first byte&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> key1</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token url-reference url variable" style="color:rgb(191, 199, 213)">15</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token url-reference url" style="color:rgb(221, 221, 221)"> </span><span class="token url-reference url punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token url-reference url" style="color:rgb(221, 221, 221)">key1</span><span class="token plain"> last byte&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>key0</code> and <code>key1</code> are then used during programming.
The file also describes the concrete bytes used in programming below (<code>key0[0]</code>, <code>key1[0]</code>, ...).
The last lines are there so the byte order isn&#x27;t swapped accidentially.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="per-token-secrets">Per-Token Secrets<a href="#per-token-secrets" class="hash-link" aria-label="Direct link to Per-Token Secrets" title="Direct link to Per-Token Secrets">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">python3 -m stustapay -c &lt;your-config&gt;.yaml token generate-nfc --count &lt;number&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This yields a list of <code>&lt;number&gt;</code> individual secrets, for example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">index,pin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0,GKBQDPD3411A</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1,R71J6YEBCF54</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This output should be supplied via a csv file to the NFC chip manufacturer.
So we provide for each chip:</p>
<ul>
<li>individual 12 character random <code>pin</code> engraved on back of chip (also stored in chip memory)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="feedback-from-manufacturer">Feedback from manufacturer<a href="#feedback-from-manufacturer" class="hash-link" aria-label="Direct link to Feedback from manufacturer" title="Direct link to Feedback from manufacturer">​</a></h2>
<p>No feedback is required (the list of pins we generated ourselves is used to verify chips and register them in the backend with an associated chip UID).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="laser">Laser<a href="#laser" class="hash-link" aria-label="Direct link to Laser" title="Direct link to Laser">​</a></h2>
<p>On the back of the chip, you can let your manufacturer engrave your payment event website url, and the PIN. Users can use this website to TopUp and see their status by logging in with the <code>PIN</code> they see on the back of their NFC chip.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pay.your-stustapay-event-name.de</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt;chip&#x27;s PIN in uppercase&gt;&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and additionally, if possible, either a datamatrix or qr-code with this url: <a href="https://pay.your-stustapay-event-name.de" target="_blank" rel="noopener noreferrer">https://pay.your-stustapay-event-name.de</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="chip-programming">Chip Programming<a href="#chip-programming" class="hash-link" aria-label="Direct link to Chip Programming" title="Direct link to Chip Programming">​</a></h2>
<p>Depending on the Chip type the data needs to be flashed into each NFC tag.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mifare-ultralight-aes-mf0aesh20">MIFARE Ultralight AES MF0AES(H)20<a href="#mifare-ultralight-aes-mf0aesh20" class="hash-link" aria-label="Direct link to MIFARE Ultralight AES MF0AES(H)20" title="Direct link to MIFARE Ultralight AES MF0AES(H)20">​</a></h3>
<p>This is the programming description for MIFARE&#x27;s <code>MF0AES(H)20</code> chip.</p>
<p>To program each chip we need to write a custom message, an <strong>individual chip pin</strong>, and the <strong>two keys</strong>.</p>
<p>The short custom message can be customized to whatever your users will read out when scanning their Chip with a smartphone - be creative :) The message is not write-protected intentionally, so user&#x27;s can update the message to something they like! Other parts of the chip are of course write protected.</p>
<p>These are the necessary chip programming commands (for more info, see the <code>MF0AES(H)20</code> data sheet):</p>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Write a short custom message (that can be changed by curious event visitors intentionally):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 04 &#x27;S&#x27; &#x27;t&#x27; &#x27;u&#x27; &#x27;S&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 05 &#x27;t&#x27; &#x27;a&#x27; &#x27;P&#x27; &#x27;a&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 06 &#x27;y&#x27; &#x27; &#x27; &#x27;-&#x27; &#x27; &#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 07 &#x27;h&#x27; &#x27;a&#x27; &#x27;v&#x27; &#x27;e&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 08 &#x27;f&#x27; &#x27;u&#x27; &#x27;n&#x27; &#x27;!&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 09 &#x27;\n&#x27; 00 00  00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 0a 00  00  00  00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 0b 00  00  00  00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 0c 00  00  00  00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 0d 00  00  00  00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 0e 00  00  00  00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 0f 00  00  00  00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Write custom individual chip pin from (the `pin` column from the generated PIN list encoded as ASCII):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 10 pin[0] pin[1] pin[2] pin[3]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 11 pin[4] pin[5] pin[6] pin[7]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 12 pin[8] pin[9] pin[10] pin[11]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Write key (key0 from the secrets):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 30 key0[15] key0[14] key0[13] key0[12]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 31 key0[11] key0[10] key0[9] key0[8]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 32 key0[7] key0[6] key0[5] key0[4]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 33 key0[3] key0[2] key0[1] key0[0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Write UID retrieval key (key1 from the secrets):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 34 key1[15] key1[14] key1[13] key1[12]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 35 key1[11] key1[10] key1[9] key1[8]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 36 key1[7] key1[6] key1[5] key1[4]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 37 key1[3] key1[2] key1[1] key1[0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Now the programming system has to go into AUTHENTICATED state using key0:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt;AUTHENTICATE with key0&gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Write Configuration:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 28 03 00 00 00 (lock pages 0x10, 0x11, 0x12, 0x13)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 2d e0 00 00 00 (lock keys, lock key lock)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 2a 80 05 00 00 (disable reading without auth,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   disable access to counter without auth,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   set virtual card id to 0x05,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   disable failed auth limit)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 29 03 00 00 10 (enable cmac, enable random id, protect from page 0x10 onwards)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That&#x27;s it, the production test should now be quite happy!</p>
<p>This programming leaves the config unlocked, as any additional writes would require an exchange of CMAC-secured messages. See the following section for a sequence of writes that locks the config, but requires the writer to support CMAC.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="programming-mf0aesh20-with-cmac-communication">Programming MF0AES(H)20 with CMAC communication<a href="#programming-mf0aesh20-with-cmac-communication" class="hash-link" aria-label="Direct link to Programming MF0AES(H)20 with CMAC communication" title="Direct link to Programming MF0AES(H)20 with CMAC communication">​</a></h4>
<p>This is an alternative programming scheme that starts just after <code>&lt;&lt;AUTHENTICATED&gt;&gt;</code> in the above commands.</p>
<p>Once CMAC is activated, all communication messages to the have to be &quot;signed&quot;.
Since a manufacturer&#x27;s assembly line most likely does not support CMAC yet, this variant is likely to work in the future only - these programming instructions just have a swapped order for when to enable CMAC.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[... write keys, authenticate]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Write Configuration (if your assembly line supports CMAC):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 28 03 00 00 00 (lock pages 0x10, 0x11, 0x12, 0x13)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 29 03 00 00 10 (enable cmac, enable random id, protect from page 0x10 onwards)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;Enable CMAC communication for the following NFC commands&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 2d e0 00 00 00 (lock keys, lock key lock)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a2 2a c0 05 00 00 (disable reading without auth,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   lock config,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   disable access to counter without auth,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   set virtual card id to 0x05,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   disable failed auth limit)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h2>
<p>After configuring the secret keys in StuStaPay, you should be able to read and validate a correctly-programmed NFC tag.</p>
<p>The StuStaPay App supports running a NFC tag production test which you can send to the manufacturer so they can validate the correct programming on-site before shipping the tags to you.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/stustapay/stustapay/tree/master/website/docs/user-guide/nfctags.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/user-guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">User Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/administrator-documentation/installation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Installation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#secret-keys" class="table-of-contents__link toc-highlight">Secret Keys</a></li><li><a href="#per-token-secrets" class="table-of-contents__link toc-highlight">Per-Token Secrets</a></li><li><a href="#feedback-from-manufacturer" class="table-of-contents__link toc-highlight">Feedback from manufacturer</a></li><li><a href="#laser" class="table-of-contents__link toc-highlight">Laser</a></li><li><a href="#chip-programming" class="table-of-contents__link toc-highlight">Chip Programming</a><ul><li><a href="#mifare-ultralight-aes-mf0aesh20" class="table-of-contents__link toc-highlight">MIFARE Ultralight AES MF0AES(H)20</a></li></ul></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/stustapay/stustapay" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 StuStaPay Developers. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>