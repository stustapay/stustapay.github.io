"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2193],{3023:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(3696);const a={},i=s.createContext(a);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:t},e.children)}},6679:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"administrator-documentation/installation","title":"Installation","description":"Currently only installations on Debian 11 (bookworm) are supported.","source":"@site/docs/administrator-documentation/installation.md","sourceDirName":"administrator-documentation","slug":"/administrator-documentation/installation","permalink":"/docs/administrator-documentation/installation","draft":false,"unlisted":false,"editUrl":"https://github.com/stustapay/stustapay/tree/master/website/docs/administrator-documentation/installation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"NFC Tag Production","permalink":"/docs/user-guide/nfctags"},"next":{"title":"Pretix Integration","permalink":"/docs/administrator-documentation/pretix"}}');var a=n(2540),i=n(3023);const r={},o="Installation",l={},c=[{value:"Setup Postgres database",id:"setup-postgres-database",level:2},{value:"Configure StuStaPay",id:"configure-stustapay",level:2},{value:"Test Mode",id:"test-mode",level:3},{value:"Migrate the database",id:"migrate-the-database",level:2},{value:"Configure Nginx",id:"configure-nginx",level:2},{value:"Start the Services",id:"start-the-services",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"installation",children:"Installation"})}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsxs)(t.p,{children:["Currently only installations on ",(0,a.jsx)(t.strong,{children:"Debian 11 (bookworm)"})," are supported."]})}),"\n",(0,a.jsxs)(t.p,{children:["Head over to the ",(0,a.jsx)(t.a,{href:"https://github.com/stustapay/stustapay/releases",children:"GitHub Release Page"})," and download the debian package for the respective version."]}),"\n",(0,a.jsx)(t.p,{children:"Install the debian package"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"sudo apt install ./stustapay_<version>+bookworm1_amd64.deb\n"})}),"\n",(0,a.jsx)(t.h2,{id:"setup-postgres-database",children:"Setup Postgres database"}),"\n",(0,a.jsx)(t.p,{children:"Install postgres (either on the same server or on a different server)."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"sudo apt install postgresql\n"})}),"\n",(0,a.jsx)(t.p,{children:"Create a new user and database (names can be altered)."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:"$ sudo -u postres psql\n> create role stustapay with password '<secure password';\n> create database stustapay owner stustapay;\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Update ",(0,a.jsx)(t.code,{children:"/etc/stustapay/config.yaml"})," and update the database connection information."]}),"\n",(0,a.jsxs)(t.p,{children:["In case postgres is not running on the same server as your stustapay installation make sure to configure tls encryption in postgres.\nYou can turn on tls encryption for the stustapay database connection by configuring the tls root certificate and setting ",(0,a.jsx)(t.code,{children:"require_ssl: true"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",metastring:'title="/etc/stustapay/config.yaml"',children:"database:\n  # ...\n  require_ssl: true\n  sslrootcert: </path/to/rootcert>\n"})}),"\n",(0,a.jsx)(t.h2,{id:"configure-stustapay",children:"Configure StuStaPay"}),"\n",(0,a.jsxs)(t.p,{children:["Generate a production application secret e.g. via ",(0,a.jsx)(t.code,{children:"pwgen -s 64 1"})," and configure it."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",metastring:'title="/etc/stustapay/config.yaml"',children:'core:\n  secret_key: "<your secret>"\n'})}),"\n",(0,a.jsx)(t.h3,{id:"test-mode",children:"Test Mode"}),"\n",(0,a.jsxs)(t.p,{children:["The default config will contain the key ",(0,a.jsx)(t.code,{children:"test_mode"})," set to ",(0,a.jsx)(t.code,{children:"true"}),".\nThis is essentially just a flag to enable a red banner in both the administration UI and the customer portal to differentiate between production and test setups.\nWe recommend leaving this enabled for the time being until you're comfortable with the setup and are ready to switch to production mode.\nAn optional message can be configured in this test mode banner via ",(0,a.jsx)(t.code,{children:"test_mode_message"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"migrate-the-database",children:"Migrate the database"}),"\n",(0,a.jsx)(t.p,{children:"Simply run"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"sudo -u stustapay stustapay db migrate\n"})}),"\n",(0,a.jsxs)(t.p,{children:["You can always open a ",(0,a.jsx)(t.code,{children:"psql"})," shell to the currently configured database by running"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"sudo -u stustapay stustapay db attach\n"})}),"\n",(0,a.jsx)(t.h2,{id:"configure-nginx",children:"Configure Nginx"}),"\n",(0,a.jsx)(t.p,{children:"Installing the debian package will also install some initial nginx config files for the terminal api, admin portal and customer portal."}),"\n",(0,a.jsxs)(t.p,{children:["These can be found under ",(0,a.jsx)(t.code,{children:"/etc/nginx/sites-available/stustapay-*"}),".\nThey are mostly ready, you just need to configure TLS certificates and update the ",(0,a.jsx)(t.code,{children:"server_name"})," settings with your desired domains."]}),"\n",(0,a.jsx)(t.p,{children:"Then just activate them via"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"ln -s /etc/nginx/sites-available/stustapay-* /etc/nginx/sites-enabled/\n"})}),"\n",(0,a.jsx)(t.h2,{id:"start-the-services",children:"Start the Services"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"sudo systemctl enable --now stustapay-administration-api.service\nsudo systemctl enable --now stustapay-terminal-api.service\nsudo systemctl enable --now stustapay-customerportal-api.service\nsudo systemctl enable --now stustapay-tse-controller.service\nsudo systemctl enable --now stustapay-payment-processor.service\nsudo systemctl enable --now stustapay-payment-processor.service\nsudo systemctl enable --now stustapay-ticket-processor.service\nsudo systemctl enable --now stustapay-bon-generator.service\n"})})]})}function u(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);